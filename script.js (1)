// ------------------------------
// LANGUAGE DATA
// ------------------------------
const LANG_DATA = {
  Sanskrit: {
    script: "Devanagari",
    chars: "à¤… à¤† à¤‡ à¤ˆ à¤‰ à¤Š à¤‹ à¤ à¤ à¤“ à¤” à¤• à¤– à¤— à¤˜ à¤™ à¤š à¤› à¤œ à¤ à¤ž à¤Ÿ à¤  à¤¡ à¤¢ à¤£ à¤¤ à¤¥ à¤¦ à¤§ à¤¨ à¤ª à¤« à¤¬ à¤­ à¤® à¤¯ à¤° à¤² à¤µ à¤¶ à¤· à¤¸ à¤¹",
    history: "1500 BCE â€“ Present â€¢ India",
    examples: ["à¤°à¤¾à¤®", "à¤§à¤°à¥à¤®", "à¤•à¤°à¥à¤®"]
  },

  Sumerian: {
    script: "Cuneiform",
    chars: "ð’€€ ð’€­ ð’€ ð’ˆ ð’€¸ ð’Œ¨ ð’†  ð’Œ“ ð’„‘ ð’Œ‹",
    history: "4000â€“2000 BCE â€¢ Mesopotamia",
    examples: ["ð’Œ“ð’€­", "ð’ˆ ð’‚µð’† ", "ð’€­ð’•"]
  },

  Egyptian: {
    script: "Hieroglyphic",
    chars: "ð“€€ ð“ ð“‚€ ð“„¿ ð“‡‹ ð“ˆ– ð“Šƒ ð“Š¹ ð“‰” ð“Šª",
    history: "3200â€“400 BCE â€¢ Egypt",
    examples: ["ð“‚€ð“Š¹", "ð“ð“Šª", "ð“ƒ€ð“‚‹"]
  },

  Akkadian: {
    script: "Cuneiform",
    chars: "ð’€­ ð’€ ð’…— ð’º ð’†  ð’Œ“ ð’ˆ  ð’„‘ ð’‰Œ",
    history: "2500â€“100 BCE â€¢ Mesopotamia",
    examples: ["ð’€ð’…—", "ð’ºð’€€", "ð’Œ“ð’„‘"]
  },

  "Ancient Greek": {
    script: "Greek Alphabet",
    chars: "Î‘ Î’ Î“ Î” Î• Î– Î— Î˜ Î™ Îš Î› Îœ Î Îž ÎŸ Î  Î¡ Î£ Î¤ Î¥ Î¦ Î§ Î¨ Î©",
    history: "800â€“600 BCE â€¢ Mediterranean",
    examples: ["Î»ÏŒÎ³Î¿Ï‚", "á¼€Î»Î®Î¸ÎµÎ¹Î±", "Ï†Î¹Î»Î¿ÏƒÎ¿Ï†Î¯Î±"]
  },

  Latin: {
    script: "Latin Alphabet",
    chars: "A B C D E F G H I K L M N O P Q R S T V X Y Z",
    history: "75 BCEâ€“200 CE â€¢ Rome",
    examples: ["Lingua", "Veritas", "Amor"]
  },

  Phoenician: {
    script: "Phoenician Alphabet",
    chars: "ð¤€ ð¤ ð¤‚ ð¤ƒ ð¤„ ð¤… ð¤† ð¤‡ ð¤ˆ ð¤‰ ð¤Š ð¤‹ ð¤Œ ð¤ ð¤Ž ð¤ ð¤ ð¤‘ ð¤’ ð¤“ ð¤” ð¤•",
    history: "1050â€“150 BCE â€¢ Levant",
    examples: ["ð¤€ð¤", "ð¤‚ð¤ƒ", "ð¤„ð¤…"]
  },

  Aramaic: {
    script: "Aramaic Script",
    chars: "Ü Ü’ Ü“ Ü• Ü— Ü˜ Ü™ Üš Ü› Ü ÜŸ Ü  Ü¡ Ü¢ Ü£ Ü¥ Ü¦ Ü¨ Ü© Üª Ü« Ü¬",
    history: "900 BCEâ€“Present â€¢ Near East",
    examples: ["Ü«Ü Ü¡Ü", "ÜŸÜ¬Ü’Ü", "Ü¥Ü Ü¡"]
  },

  Arabic: {
    script: "Arabic Alphabet",
    chars: "Ø§ Ø¨ Øª Ø« Ø¬ Ø­ Ø® Ø¯ Ø° Ø± Ø² Ø³ Ø´ Øµ Ø¶ Ø· Ø¸ Ø¹ Øº Ù Ù‚ Ùƒ Ù„ Ù… Ù† Ù‡ Ùˆ ÙŠ",
    history: "4th century CE â€“ Present â€¢ Middle East",
    examples: ["Ø³Ù„Ø§Ù…", "ÙƒØªØ§Ø¨", "Ø¹Ù„Ù…"]
  },

  English: {
    script: "Latin Alphabet",
    chars: "A B C D E F G H I J K L M N O P Q R S T U V W X Y Z",
    history: "5th century CE â€“ Present â€¢ England",
    examples: ["hello", "world", "language"]
  },

  Spanish: {
    script: "Latin Alphabet",
    chars: "A B C D E F G H I J K L M N Ã‘ O P Q R S T U V W X Y Z",
    history: "9th century CE â€“ Present â€¢ Spain",
    examples: ["hola", "mundo", "lenguaje"]
  },

  French: {
    script: "Latin Alphabet",
    chars: "A B C D E F G H I J K L M N O P Q R S T U V W X Y Z",
    history: "9th century CE â€“ Present â€¢ France",
    examples: ["bonjour", "monde", "langue"]
  }
};

// ------------------------------
// NO MEANING TEXT PER LANGUAGE
// ------------------------------
const NO_MEANING_TEXT = {
  English: "No clear meaning",
  Spanish: "Sin significado claro",
  French: "Sans signification claire",
  Arabic: "Ù„Ø§ Ù…Ø¹Ù†Ù‰ ÙˆØ§Ø¶Ø­"
};

// ------------------------------
// VARIABLES
// ------------------------------
let testerLanguage = "";
let translationLanguage = "";

const infoPanel = document.getElementById("infoPanel");
const infoBtn = document.getElementById("infoBtn");
const fromCard = document.getElementById("fromCard");
const toCard = document.getElementById("toCard");
const translationCard = document.getElementById("translationText");
const explanationCard = document.getElementById("explanationText");

// ------------------------------
// UPDATE HEADER
// ------------------------------
const updateHeader = () => {
  if (testerLanguage) {
    const data = LANG_DATA[testerLanguage];
    fromCard.querySelector(".native.big").textContent = data ? data.examples[0] || "â€”" : "â€”";
    fromCard.querySelector(".english").textContent = testerLanguage;
  }
  if (translationLanguage) {
    const data = LANG_DATA[translationLanguage];
    toCard.querySelector(".native.big").textContent = data ? data.examples[0] || "â€”" : "â€”";
    toCard.querySelector(".english").textContent = translationLanguage;
  }
};

// ------------------------------
// CLEAR CARD SELECTION
// ------------------------------
const clearSelection = (selector) => {
  document.querySelectorAll(selector).forEach(c => c.classList.remove("selected"));
};

// ------------------------------
// SOURCE LANGUAGE
// ------------------------------
document.querySelectorAll(".card.source").forEach(card => {
  card.addEventListener("click", () => {
    testerLanguage = card.dataset.lang;
    clearSelection(".card.source");
    card.classList.add("selected");
    updateHeader();

    const data = LANG_DATA[testerLanguage];
    if (!data) return;

    document.getElementById("infoTitle").innerText = testerLanguage;
    document.getElementById("infoScript").innerText = data.script;
    document.getElementById("infoChars").innerText = data.chars;
    document.getElementById("infoHistory").innerText = data.history;

    const ul = document.getElementById("infoExamples");
    ul.innerHTML = "";
    data.examples.forEach(e => {
      const li = document.createElement("li");
      li.textContent = e;
      ul.appendChild(li);
    });

    infoBtn.innerText = testerLanguage + " Reference";
  });
});

// ------------------------------
// TARGET LANGUAGE
// ------------------------------
document.querySelectorAll(".card.target").forEach(card => {
  card.addEventListener("click", () => {
    translationLanguage = card.dataset.lang;
    clearSelection(".card.target");
    card.classList.add("selected");
    updateHeader();
  });
});

// ------------------------------
// INFO BUTTON TOGGLE
// ------------------------------
infoBtn.addEventListener("click", () => {
  infoPanel.classList.toggle("hidden");
  infoPanel.classList.toggle("show");
});

// ------------------------------
// TRANSLATE BUTTON
// ------------------------------
document.getElementById("translateBtn").addEventListener("click", async () => {
  const input = document.getElementById("inputText").value.trim();

  if (!input || !testerLanguage || !translationLanguage) {
    translationCard.textContent = "Select both languages and enter text.";
    explanationCard.textContent = "";
    return;
  }

  // Show loading
  translationCard.textContent = "Translating...";
  explanationCard.textContent = "Translating...";

  const noMeaning = NO_MEANING_TEXT[translationLanguage] || "No clear meaning";

  try {
    const res = await fetch("https://openrouter.ai/api/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer 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"
      },
      body: JSON.stringify({
        model: "deepseek/deepseek-r1-0528:free",
        messages: [
          {
            role: "system",
            content: `Translate from ${testerLanguage} to ${translationLanguage}.
                      Give ONLY the plain translation in the first line.
                      Then give a clear explanation in plain text.
                      Do NOT include markdown or special formatting.
                      If the word does not exist, say '${noMeaning}'.`
          },
          { role: "user", content: input }
        ]
      })
    });

    const data = await res.json();
    const result = data.choices[0].message.content;

    // Split into translation + explanation
    const lines = result.split("\n").filter(l => l.trim());
    translationCard.textContent = lines[0] || noMeaning;
    explanationCard.textContent = lines.slice(1).join("\n") || noMeaning;

  } catch (err) {
    console.error(err);
    translationCard.textContent = "Translation failed.";
    explanationCard.textContent = "";
  }
});
